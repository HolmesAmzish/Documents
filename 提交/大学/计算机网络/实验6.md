# Web 服务器的配置与管理

## 6.1 预备知识  

- 熟悉DNS、HTTP、HTTPS协议的工作原理  

## 6.2 Nginx 的配置  

### 6.2.1 实验目的  

1. 了解Nginx的工作原理，掌握Nginx的安装与配置方法；
2. 掌握在一台nginx服务器上配置运行多个网站的方法；
3. 了解Nginx负载均衡的实现原理，能够利用Nginx进行负载均衡；
4. 了解Nginx访问控制的实现原理，能够利用Nginx进行访问控制。  

### 6.2.2 实验内容  

#### 1. 安装Nginx

首先安装Nginx

```bash
apt install nginx -y
```

```
cacc@purgatory-v:~$ sudo apt install nginx
[sudo] password for cacc:
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following additional packages will be installed:
  iproute2 libatm1 libbpf0 libcap2-bin libdeflate0 libelf1 libgd3 libjbig0 libmaxminddb0 libmnl0 libnginx-mod-http-geoip2
  libnginx-mod-http-image-filter libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream
  libnginx-mod-stream-geoip2 libpam-cap libpam-runtime libtiff5 libwebp7 libx11-6 libx11-data libxau6 libxcb1 libxdmcp6
  libxpm4 libxslt1.1 libxtables12 nginx-common nginx-core
Suggested packages:
  iproute2-doc libgd-tools mmdb-bin fcgiwrap nginx-doc ssl-cert
The following NEW packages will be installed:
  iproute2 libatm1 libbpf0 libcap2-bin libdeflate0 libelf1 libgd3 libjbig0 libmaxminddb0 libmnl0 libnginx-mod-http-geoip2
  libnginx-mod-http-image-filter libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream
  libnginx-mod-stream-geoip2 libpam-cap libpam-runtime libtiff5 libwebp7 libx11-6 libx11-data libxau6 libxcb1 libxdmcp6
  libxpm4 libxslt1.1 libxtables12 nginx nginx-common nginx-core
0 upgraded, 31 newly installed, 0 to remove and 1 not upgraded.
Need to get 3,800 kB of archives.
After this operation, 12.3 MB of additional disk space will be used.
```

尝试启动Nginx服务

```bash
sudo systemctl start nginx
sudo systemctl status nginx
```

```
cacc@purgatory-v:~$ sudo systemctl status nginx
○ nginx.service - A high performance web server and a reverse proxy server
     Loaded: loaded (/lib/systemd/system/nginx.service; disabled; vendor preset: enabled)
     Active: inactive (dead)
       Docs: man:nginx(8)
cacc@purgatory-v:~$ sudo systemctl start nginx
Job for nginx.service failed because the control process exited with error code.
See "systemctl status nginx.service" and "journalctl -xeu nginx.service" for details.
cacc@purgatory-v:~$ systemctl status nginx
× nginx.service - A high performance web server and a reverse proxy server
     Loaded: loaded (/lib/systemd/system/nginx.service; disabled; vendor preset: enabled)
     Active: failed (Result: exit-code) since Mon 2024-12-02 21:48:37 CST; 10s ago
       Docs: man:nginx(8)
    Process: 3330 ExecStartPre=/usr/sbin/nginx -t -q -g daemon on; master_process on; (code=exited, status=0/SUCCESS)
    Process: 3331 ExecStart=/usr/sbin/nginx -g daemon on; master_process on; (code=exited, status=1/FAILURE)
        CPU: 51ms

Dec 02 21:48:35 purgatory-v nginx[3331]: nginx: [emerg] bind() to 0.0.0.0:80 failed (98: Unknown error)
Dec 02 21:48:35 purgatory-v nginx[3331]: nginx: [emerg] bind() to [::]:80 failed (98: Unknown error)
Dec 02 21:48:36 purgatory-v nginx[3331]: nginx: [emerg] bind() to 0.0.0.0:80 failed (98: Unknown error)
Dec 02 21:48:36 purgatory-v nginx[3331]: nginx: [emerg] bind() to [::]:80 failed (98: Unknown error)
Dec 02 21:48:36 purgatory-v nginx[3331]: nginx: [emerg] bind() to 0.0.0.0:80 failed (98: Unknown error)
Dec 02 21:48:36 purgatory-v nginx[3331]: nginx: [emerg] bind() to [::]:80 failed (98: Unknown error)
Dec 02 21:48:37 purgatory-v nginx[3331]: nginx: [emerg] still could not bind()
Dec 02 21:48:37 purgatory-v systemd[1]: nginx.service: Control process exited, code=exited, status=1/FAILURE
Dec 02 21:48:37 purgatory-v systemd[1]: nginx.service: Failed with result 'exit-code'.
Dec 02 21:48:37 purgatory-v systemd[1]: Failed to start A high performance web server and a reverse proxy server.
```

发现无法启动，后来想起来我在这个服务器上的SpringBoot测试项目占用了80端口，关闭后尝试重启发现启动成功。

```

cacc@purgatory-v:~$ sudo systemctl stop demo
cacc@purgatory-v:~$ sudo systemctl restart nginx
cacc@purgatory-v:~$ systemctl status nginx
● nginx.service - A high performance web server and a reverse proxy server
     Loaded: loaded (/lib/systemd/system/nginx.service; disabled; vendor preset: enabled)
     Active: active (running) since Mon 2024-12-02 21:50:44 CST; 3s ago
       Docs: man:nginx(8)
    Process: 4117 ExecStartPre=/usr/sbin/nginx -t -q -g daemon on; master_process on; (code=exited, status=0/SUCCESS)
    Process: 4118 ExecStart=/usr/sbin/nginx -g daemon on; master_process on; (code=exited, status=0/SUCCESS)
   Main PID: 4119 (nginx)
      Tasks: 5 (limit: 9261)
     Memory: 4.8M
        CPU: 28ms
     CGroup: /system.slice/nginx.service
             ├─4119 "nginx: master process /usr/sbin/nginx -g daemon on; master_process on;"
             ├─4120 "nginx: worker process" "" "" "" "" "" "" "" "" "" "" "" "" >
             ├─4121 "nginx: worker process" "" "" "" "" "" "" "" "" "" "" "" "" >
             ├─4122 "nginx: worker process" "" "" "" "" "" "" "" "" "" "" "" "" >
             └─4123 "nginx: worker process" "" "" "" "" "" "" "" "" "" "" "" "" >

Dec 02 21:50:44 purgatory-v systemd[1]: Starting A high performance web server and a reverse proxy server...
Dec 02 21:50:44 purgatory-v systemd[1]: Started A high performance web server and a reverse proxy server.
cacc@purgatory-v:~$
```

![image-20241202215219073](C:\Users\Holme\AppData\Roaming\Typora\typora-user-images\image-20241202215219073.png)



#### 2. 使用启用其他端口



#### 3. 均衡负载

#### 4. 访问控制

## 6.3 思考与提高 

在B/S 的应用中，什么是跨域问题？一般跨域问题的解决思路有哪些？在Nginx 中能 否解决跨域问题？如何能，如何配置实现？并实验验证它。